# 운영체제란

대표적인 시스템 소프트웨어

## 운영체제의 역할

1. 자원 관리로 컴퓨터 시스템을 효율적으로 운영하는 것

- 하드웨어 자원
- 소프트웨어 자원

2. 사용자 지원
   운영체제는 사용자가 내린 명령을 해석하여 실행하며 사용자와 하드웨어 사이의 매개체 역할을 하면서 사용자에게 편의성을 제공

## 모드

1. 커널 모드
   하드웨어를 직접 제어할 수 있는 CPU의 명령어를 사용할 수 있는 모드
1. 일체형 커널
   운영체제의 모든 서비스가 커널 내에 포함된 커널
1. 마이크로커널
   운영체제 요소의 대부분을 커널 외부로 분리하여 커널 내부에는 메모리 관리, 프로세스 간 통신, 멀티태스킹 등 최소한 요소만 남겨 놓은 커널

1. 사용자 모드(보호 모드)
   하드웨어를 직접 제어할 수 있는 CPU의 명령어를 사용할 수 없는 모드

- 커널 모드에서는 운영체제만 동작하므로 응용 프로그램은 사용자 모드에서만 동작한다
- 시스템 호출: 응용 프로그램이 하드웨어에 대한 제어가 필요한 경우 운영체제에 서비스를 요청하는 메커니즘

## 운영체제의 구성

1. 프로세스 관리자

- CPU를 할당하기 위한 스케줄을 결정
- 프로세스의 상태를 관리

2. 메모리 관리자

- 메모리 할당 및 회수
- 운영체제가 직접 사용하는 메모리 공간에 응용 프로그램의 프로세스가 접근하지 못하도록 해야함

3. 장치 관리자

- 컴퓨터 시스템의 모든 장치를 관리

4. 파일 관리자

- 프로그램 파일과 데이터 파일을 관리
- 저장장치의 공간과 파일의 생성, 수정 등의 접근 제한도 관리

## 운영체제의 유형

1. 일괄처리 운영체제
   작업을 모아서 순서대로 처리하는 방식

2. 시분할 운영체제
   사용자의 프로그램을 한번에 조금씩 수행하여 여러 프로그램이 동시에 실행되는 것과 비슷한 효과를 내는 방식
   요청한 시점부터 반응이 시작되는 시점까지의 소요시간을 의미하는 응답시간이 일괄처리 운영체제보다 크게 단축됨

3. 실시간 운영체제
   원하는 시간 내에 프로그램의 결과를 얻을 수 있는 운영체제
   즉 처리기한을 맞추는 것이 중요한 우선순위가 높은 작업을 우선 처리할 수 있는 기법 활용

4. 분산 운영체제
   네트워크를 통해 다른 컴퓨터 시스템의 자원을 이용하는 것이 자신의 컴퓨터 시스템에 있는 자원을 이용하는 것처럼 가능하도록 함

---

# 프로세스

실행 중인 프로그램

- 프로그램은 디스크 내 파일로 존재하는 동작하지 않는 정적이며 수동적인 개체
- 프로세스는 프로그램을 실행시킨 것으로 운영체제로부터 프로그램이 동작을 하는데 필요한 CPU, 메모리, 입출력장치, 파일 등의 자원을 할당받아 동작을 시작한 것, 능동적인 개체
- 하나의 메모리 구조를 갖고 그 안의 코드 영역에 대해 하나의 제어 흐름을 가짐 -> 코드 영역, 정적 데이터 영역, 스택 영역, 힙 영역
- 프로그램 카운터가 가리키는 명령을 처리하는데 하나의 프로세스는 하나의 PC만 유지하므로 제어 흐름을 하나만 갖기 때문에 기본적으로 다중 처리가 불가능하다는 특징이 있다.

## 프로세스의 구성

- 메모리 구조
- 코드 영역: 프로그램 자체
- 데이터 영역
- 정적 데이터: 상수, 전역변수
- 스택: 지역변수, 매개변수
- 힙: 동적
- 프로세스 제어 블록(PCB): 프로세스의 정보를 보관

- PID: 프로세스 식별자
- PC(프로그램 카운터): 다음에 실행할 명령의 주소
- 상태
- 레지스터
- 프로세스 우선순위
- 메모리 관리 정보: 프로세스가 저장된 주소와 가상 메모리의 실주소의 사상 정보 등
  운영체제는 보통 여러 프로세스를 동시에 관리하며 번갈아 실행시키게 된다. 실행 중이던 프로세스의 정보를 PCB에 저장한 후 나중에 이 프로세스를 다시 실행하게 되면 프로세스 제어 블록에 저장된 정보를 이용하여 이어서 실행한다.

## 프로세스 상태 관리

1. 생성: 처음 작업이 주어진 상태로 프로세스 제어 블록을 생성하고 작업 큐에 넣는다.
2. 준비: 프로세스의 메모리 구조가 생성되어 CPU 할당을 기다리는 상태로 준비 큐에 머물다가 CPU를 할당받으면 실행 상태로 전이된다.
3. 실행: 프로세스가 처리되는 상태, CPU를 할당하는 과정을 디스패치라고 한다.

- 스케줄러가 준비 큐에서 다른 프로세스를 선택하게 되면 실행 상태의 프로세스는 CPU를 회수당하고 준비 상태로 전이된다.
- 실행 상태 프로세스가 입출력을 요구하는 작업이나 페이지 교환을 요구하는 작업을 만나면 대기 상태로 전이된다. (이러한 작업은 상대적으로 오랜 시간이 걸리기 때문에 CPU를 다른 프로세스에 할당하여 활용하기 위함)

4. 대기: 프로세스가 I/O 작업이 끝날 때까지 특정 자원을 할당 받을 때까지 보류되는 상태
5. 종료: 프로세스가 더 이상 실행되지 않도록 끝난 상태

## 부모 프로세스/자식 프로세스

한 프로세스가 다른 프로세스를 생성하는 방법 -> 프로세스 생성 시스템 호출

1. 부모 프로세스: 시스템 호출을 하는 프로세스
2. 자식 프로세스: 시스템 호출을 통해 새로 생성된 프로세스

- UNIX, Linux

  - fork() 시스템 호출을 통해 부모 프로세스의 복제본인 자식 프로세스 생성 (부모 프로세스의 메모리 구조와 동일)
  - exec() 을 사용하면 자식 프로세스가 부모 프로세스와 다른 프로그램을 실행함

- Windows
  - CreateProcess() 시스템 호출 사용, 이는 처음부터 새로운 프로그램으로 자식 프로세스를 생성

## 프로세스 종료

- 일반적인 경우: 프로세스의 마지막 명령이 실행을 마쳐 모든 처리를 완료하고 정상적으로 종료
- 부모 프로세스가 자식 프로세스의 번호를 이용하여 프로세스 종료 시스템 호출로 종료
- 부모 프로세스가 종료되는 경우 운영체제에 의해 자식 프로세스들이 모두 종료

다만 자식 프로세스가 종료되어 자원이 회수되더라도 자식 프로세스의 프로세스 제어 블록(PCB)은 부모 프로세스가 결과를 받을 때까지 사라지지 않고 유지 된다.

---

# 쓰레드

프로세스 내에서 다중 처리를 위해 제안된 개념
(자원 소유의 단위는 프로세스, 디스패칭의 단위는 쓰레드)

- 쓰레드마다 프로그램 카운터(PC)가 있어 쓰레드별로 디스패칭이 가능 (+레지스터, 스택)
- 각 쓰레드는 실행에 필요한 최소한의 정보만 가짐 (그 외 정보는 프로세스에 두고 다른 쓰레드와 공유)
- 쓰레드 또한 프로세스처럼 생성, 준비, 실행, 대기, 종료상태를 가짐

---

# 프로세스 스케줄링

1. 상위단계 스케줄링(장기 스케줄링)
   시스템에 들어와 작업 큐에 있는 작업을 선택하여 프로세스를 생성한 뒤 프로세스 준비 큐에 전달
   - 입출력 중심 작업/연산 중심 작업을 균형있게 선택하도록 작업순서 결정
2. 중간단계 스케줄링(중기 스케줄링)
   프로세스를 일시적으로 메모리에서 제거하여 중지시키거나 중지된 프로세스에 다시 메모리를 할당하여 활성화시켜 시스템에 대한 단기적인 부하를 조절하는 역할
   - 시스템이 과부하되는 경우 메모리에서 어떤 프로세스를 제거해야 시스템의 부하가 줄어들지를 결정하여 실제로 중지시켜준다
3. 하위단계 스케줄링(단기 스케줄링)
   준비큐에 있는 프로세스를 선택하여 사용 가능한 CPU를 할당하는 역할

## 스케줄링의 목표

1. 공정성: 모든 프로세스가 적정 수준에서 CPU 작업을 할 수 있게 하는 것
2. 균형성: 시스템의 자원들이 충분히 활용될 수 있게 하는 것

### 목표 기준

1. 처리량(throughput): 주어진 시간에 처리한 프로세스 수
2. 반환시간(turnaround time): 프로세스 생성 시점부터 종료 시점까지의 소요시간
3. 응답시간(response time): 요청한 시점부터 반응이 시작되는 시점까지의 소요시간
4. 대기시간(waiting time): 프로세스가 종료될 때까지 준비큐에 기다린 시간의 합

### 일괄처리 운영체제 목표

처리량의 극대화, 반환시간의 최소화, CPU 활용의 극대화

### 시분할 운영체제 목표

빠른 응답시간, 과다한 대기 시간 방지

### 실시간 운영체제 목표

처리기한 맞추기

## 스케줄링 정책(하위단계 스케줄링)

1. 선점 스케줄링 정책

- 실행 중인 프로세스에 인터럽트를 걸고 다른 프로세스에 CPU를 할당할 수 있는 스케줄링 방식
- 높은 우선순위의 프로세스를 우선 처리해야 하는 경우 유용
- 컨텍스트 스위칭이 일어나며 오버헤드 발생
  - 컨텍스트란 CPU의 모든 레지스터와 운영체제에 따라 요구되는 프로세스의 상태
  - 컨텍스트 스위칭은 CPU가 현재 실행하고 있는 프로세스의 문맥을 프로세스 제어 블록에 저장하고 다른 프로세스의 프로세스 제어 블록으로부터 문맥을 복원하는 작업

2. 비선점 스케줄링 정책

- 실행 중인 프로세스를 바로 준비상태로 전이시킬 수 없는 스케줄링 방식
- CPU를 할당받아 실행이 시작된 프로세스는 대기/종료상태로 전이될 때까지 계속 실행상태에 있게 된다
